from typing import List
from datetime import datetime
from langchain_core.messages import SystemMessage, HumanMessage

# ========== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========

def get_current_date():
    """í˜„ì¬ ë‚ ì§œë¥¼ ì½ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë°˜í™˜"""
    return datetime.now().strftime("%Yë…„ %mì›” %dì¼")

# ========== í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ==========

validation_instructions = """ë‹¹ì‹ ì€ ì œí’ˆ ì¶”ì²œ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë¶„ì„í•˜ì—¬ ì œí’ˆ ê²€ìƒ‰ì— ì¶©ë¶„í•œ ì •ë³´ê°€ ìˆëŠ”ì§€ íŒë‹¨í•´ì£¼ì„¸ìš”.

Instructions:
- ì‚¬ìš©ìì˜ ìš”ì²­ì´ êµ¬ì²´ì ì´ê³  ê²€ìƒ‰ ê°€ëŠ¥í•œì§€ í‰ê°€í•˜ì„¸ìš”.
- ë¶ˆì¶©ë¶„í•œ ê²½ìš° êµ¬ì²´í™”ë¥¼ ìœ„í•œ ì§ˆë¬¸ì„ ìƒì„±í•˜ì„¸ìš”.
- í˜„ì¬ ë‚ ì§œëŠ” {current_date}ì…ë‹ˆë‹¤.

êµ¬ì²´ì ì¸ ìš”ì²­ì˜ ê¸°ì¤€:
- ì œí’ˆ ì¹´í…Œê³ ë¦¬ê°€ ëª…í™•í•¨ (ì˜ˆ: ë…¸íŠ¸ë¶, ì´ì–´í°, í‚¤ë³´ë“œ ë“±)
- ìš©ë„ë‚˜ ëª©ì ì´ ì–¸ê¸‰ë¨ (ì˜ˆ: ê²Œì´ë°ìš©, ì—…ë¬´ìš©, í•™ìŠµìš© ë“±)
- ë¸Œëœë“œ ì„ í˜¸ë„ë‚˜ íŠ¹ì • ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ì´ ìˆìŒ

ë¶ˆì¶©ë¶„í•œ ìš”ì²­ ì˜ˆì‹œ:
- "í‚¤ë³´ë“œ ì¶”ì²œí•´ì¤˜"
- "ì¢‹ì€ ë…¸íŠ¸ë¶ ì•Œë ¤ì¤˜"
- "ì´ì–´í° ë­ê°€ ì¢‹ì„ê¹Œ?"
- "í™”ì¥í’ˆ ì¶”ì²œí•´ì¤˜"

ì¶©ë¶„í•œ ìš”ì²­ ì˜ˆì‹œ:
- "10ë§Œì› ì´í•˜ ê°€ì„±ë¹„ ì¢‹ì€ ê²Œì´ë° í‚¤ë³´ë“œ ì¶”ì²œí•´ì¤˜"
- "ëŒ€í•™ìƒìš© ë¬¸ì„œì‘ì—… ë…¸íŠ¸ë¶ ì¶”ì²œ, ì˜ˆì‚° 100ë§Œì›"
- "ìš´ë™í•  ë•Œ ì“¸ ë¬´ì„  ì´ì–´í°, ë°©ìˆ˜ ê¸°ëŠ¥ ìˆëŠ” ê±¸ë¡œ"
- "ì €ë ´í•œ ìŠ¤í‚¨ì¼€ì–´ ì œí’ˆ ì¶”ì²œí•´ì¤˜"
- ì¹œí™˜ê²½ì ì¸ ì£¼ë°©ìš©í’ˆ ë¸Œëœë“œë¥¼ ì¶”ì²œí•˜ê³  ê° ì œí’ˆì˜ íŠ¹ì§•ì„ ì•Œë ¤ì¤˜.

Output Format:
- Format your response as a JSON object with these exact keys:
   - "is_specific": true or false
   - "clarification_question": ë¶ˆì¶©ë¶„í•  ê²½ìš° êµ¬ì²´í™”ë¥¼ ìœ„í•œ ì§ˆë¬¸ (í•œêµ­ì–´, is_specificì´ falseì¸ ê²½ìš°ë§Œ, ì•„ë‹ˆë©´ ë¹ˆ ë¬¸ìì—´)
   - "extracted_requirements": ì¶”ì¶œëœ ìš”êµ¬ì‚¬í•­ë“¤ì„ JSON ê°ì²´ë¡œ (ì˜ˆ: {{"ì¹´í…Œê³ ë¦¬": "í‚¤ë³´ë“œ", "ìš©ë„": "ê²Œì´ë°", "ì˜ˆì‚°": "10ë§Œì›"}})

ì‚¬ìš©ì ìš”ì²­: {user_message}"""

def get_validation_prompt(user_message: str) -> List:
    """ìš”ì²­ ê²€ì¦ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±"""
    current_date = get_current_date()
    system_prompt = validation_instructions.format(
        current_date=current_date,
        user_message=user_message
    )
    
    return [
        SystemMessage(content=system_prompt),
        HumanMessage(content=f"ì‚¬ìš©ì ìš”ì²­ì„ ë¶„ì„í•´ì£¼ì„¸ìš”: {user_message}")
    ]

query_writer_instructions = """ë‹¹ì‹ ì€ ì œí’ˆ ê²€ìƒ‰ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì„ ë¶„ì„í•˜ì—¬ í•œêµ­ ì»¤ë®¤ë‹ˆí‹°ì™€ ë¦¬ë·° ì‚¬ì´íŠ¸ì—ì„œ íš¨ê³¼ì ì¸ ê²€ìƒ‰ì–´ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.

Instructions:
- ê° ê²€ìƒ‰ì–´ëŠ” ì„œë¡œ ë‹¤ë¥¸ ê´€ì ì„ ë‹¤ë¤„ì•¼ í•©ë‹ˆë‹¤.
- ìµœëŒ€ {max_queries}ê°œê¹Œì§€ ìƒì„±í•˜ì„¸ìš”.
- í•œêµ­ ì»¤ë®¤ë‹ˆí‹°ì™€ ë¦¬ë·° ì‚¬ì´íŠ¸ì—ì„œ ì˜ ê²€ìƒ‰ë  ìˆ˜ ìˆëŠ” í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
- ë¸Œëœë“œëª…, ê°€ê²©ëŒ€, ìš©ë„, ì„±ëŠ¥ ë“± ë‹¤ì–‘í•œ ê°ë„ì—ì„œ ì ‘ê·¼í•˜ì„¸ìš”.
- í˜„ì¬ ë‚ ì§œëŠ” {current_date}ì…ë‹ˆë‹¤. ìµœì‹  ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆëŠ” ê²€ìƒ‰ì–´ë¥¼ ìƒì„±í•˜ì„¸ìš”.

ê²€ìƒ‰ì–´ ìƒì„± ì›ì¹™:
1. í•œêµ­ ì»¤ë®¤ë‹ˆí‹° íŠ¹í™” í‚¤ì›Œë“œ í¬í•¨ (ë””ì‹œ, í´ë¦¬ì•™, ë½ë¿Œ ë“±)
2. ê°€ê²©ëŒ€ ë° ì„±ëŠ¥ ê´€ë ¨ í‚¤ì›Œë“œ í™œìš©
3. ë¦¬ë·° ë° ì‚¬ìš©ê¸° ê´€ë ¨ í‚¤ì›Œë“œ í¬í•¨
4. ìµœì‹  íŠ¸ë Œë“œ ë°˜ì˜

ê²€ìƒ‰ì–´ ì˜ˆì‹œ:
- "ê°€ì„±ë¹„ ê²Œì´ë° í‚¤ë³´ë“œ ì¶”ì²œ 2024 ë””ì‹œ"
- "10ë§Œì› ì´í•˜ ê¸°ê³„ì‹ í‚¤ë³´ë“œ í›„ê¸° í´ë¦¬ì•™"
- "ë¡œì§€í… ë ˆì´ì € í‚¤ë³´ë“œ ë¦¬ë·° ì‚¬ìš©ê¸°"

Format:
- Format your response as a JSON object with these exact keys:
   - "rationale": ê° ê²€ìƒ‰ì–´ë¥¼ ì„ íƒí•œ ì´ìœ ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…
   - "queries": ê²€ìƒ‰ì–´ ë¦¬ìŠ¤íŠ¸

ì‚¬ìš©ì ìš”ì²­: {user_message}
ì¶”ì¶œëœ ì˜ë„: {user_intent}"""

def get_search_query_prompt(user_message: str, user_intent: str, max_queries: int) -> List:
    """ê²€ìƒ‰ì–´ ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸"""
    current_date = get_current_date()
    system_prompt = query_writer_instructions.format(
        max_queries=max_queries,
        current_date=current_date,
        user_message=user_message,
        user_intent=user_intent
    )

    return [
        SystemMessage(content=system_prompt),
        HumanMessage(content=f"ë‹¤ìŒ ìš”ì²­ì— ëŒ€í•œ íš¨ê³¼ì ì¸ ê²€ìƒ‰ì–´ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”:\nìš”ì²­: {user_message}\nì˜ë„: {user_intent}")
    ]

web_searcher_instructions = """í•œêµ­ ì œí’ˆ ì¶”ì²œ ì‚¬ì´íŠ¸ì—ì„œ "{search_query}"ì— ëŒ€í•œ ìµœì‹  ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ê²€ì¦ ê°€ëŠ¥í•œ ì œí’ˆ ì •ë³´ë¡œ ì¢…í•©í•´ì£¼ì„¸ìš”.

Instructions:
- í˜„ì¬ ë‚ ì§œëŠ” {current_date}ì…ë‹ˆë‹¤. ìµœì‹  ì •ë³´ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ì„¸ìš”.
- ë‹¤ì–‘í•œ í•œêµ­ ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸ì—ì„œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì„¸ìš”.
- ê° ì •ë³´ì˜ ì¶œì²˜ë¥¼ ì •í™•íˆ ì¶”ì í•˜ì—¬ ê¸°ë¡í•˜ì„¸ìš”.
- ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ì°¾ì€ ì •ë³´ë§Œ í¬í•¨í•˜ê³ , ì„ì˜ë¡œ ì •ë³´ë¥¼ ë§Œë“¤ì–´ë‚´ì§€ ë§ˆì„¸ìš”.

ê²€ìƒ‰ ì‹œ ì£¼ëª©í•  ì‚¬ì´íŠ¸:
- ë„¤ì´ë²„ ë¸”ë¡œê·¸, ì¹´í˜
- ë””ì‹œì¸ì‚¬ì´ë“œ
- í´ë¦¬ì•™
- ë½ë¿Œ
- ë‹¤ë‚˜ì™€
- ì¿ íŒ¡, ë„¤ì´ë²„ì‡¼í•‘

ê° ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”:
1. ì¶”ì²œ ì œí’ˆëª… (ì •í™•í•œ ëª¨ë¸ëª…)
2. ê°€ê²© ì •ë³´ ë° ê°€ê²©ëŒ€
3. ì£¼ìš” íŠ¹ì§• ë° ì¥ì 
4. ì‚¬ìš©ì ë¦¬ë·° ë° ì¶”ì²œ ì´ìœ 
5. êµ¬ë§¤ ë§í¬ ë˜ëŠ” ìƒì„¸ ì •ë³´ ë§í¬
6. ì¶œì²˜ URL

ê²€ìƒ‰ ì£¼ì œ: {search_query}"""

def get_web_search_prompt(query: str) -> str:
    """ì›¹ ê²€ìƒ‰ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸"""
    current_date = get_current_date()
    return web_searcher_instructions.format(
        search_query=query,
        current_date=current_date
    )

reflection_instructions = """ë‹¹ì‹ ì€ ì œí’ˆ ì¶”ì²œ ê²°ê³¼ë¥¼ í‰ê°€í•˜ëŠ” ì „ë¬¸ ë¦¬ì„œì¹˜ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. "{user_request}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤.

Instructions:
- í˜„ì¬ ì œí’ˆ ëª©ë¡ì´ ì‚¬ìš©ì ìš”ì²­ì„ ì¶©ì¡±í•˜ëŠ”ì§€ ë¶„ì„í•˜ì„¸ìš”.
- ì§€ì‹ ê²©ì°¨ë‚˜ ë” ê¹Šì´ íƒìƒ‰ì´ í•„ìš”í•œ ì˜ì—­ì„ ì‹ë³„í•˜ê³  í›„ì† ê²€ìƒ‰ì–´ë¥¼ ìƒì„±í•˜ì„¸ìš”.
- ì œê³µëœ ì œí’ˆ ëª©ë¡ì´ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µí•˜ê¸°ì— ì¶©ë¶„í•˜ë‹¤ë©´ í›„ì† ê²€ìƒ‰ì–´ë¥¼ ìƒì„±í•˜ì§€ ë§ˆì„¸ìš”.
- ì§€ì‹ ê²©ì°¨ê°€ ìˆë‹¤ë©´ ì´í•´ë¥¼ í™•ì¥í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” í›„ì† ê²€ìƒ‰ì–´ë¥¼ ìƒì„±í•˜ì„¸ìš”.
- ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­, êµ¬í˜„ ì‚¬ì–‘ ë˜ëŠ” ì™„ì „íˆ ë‹¤ë£¨ì–´ì§€ì§€ ì•Šì€ ìƒˆë¡œìš´ íŠ¸ë Œë“œì— ì§‘ì¤‘í•˜ì„¸ìš”.

Requirements:
- í›„ì† ê²€ìƒ‰ì–´ëŠ” ìì²´ì ìœ¼ë¡œ ì™„ê²°ë˜ê³  ì›¹ ê²€ìƒ‰ì— í•„ìš”í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
- í•œêµ­ ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸ì—ì„œ ê²€ìƒ‰í•˜ê¸° ì í•©í•œ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

Output Format:
- Format your response as a JSON object with these exact keys:
   - "is_sufficient": true or false
   - "knowledge_gap": ëˆ„ë½ëœ ì •ë³´ë‚˜ ëª…í™•í™”ê°€ í•„ìš”í•œ ë‚´ìš© ì„¤ëª… (is_sufficientê°€ trueë©´ ë¹ˆ ë¬¸ìì—´)
   - "additional_queries": ì´ ê²©ì°¨ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ êµ¬ì²´ì ì¸ ê²€ìƒ‰ì–´ ëª©ë¡ (is_sufficientê°€ trueë©´ ë¹ˆ ë°°ì—´)

Example:
```json
{{
    "is_sufficient": false,
    "knowledge_gap": "í˜„ì¬ ê²°ê³¼ì—ëŠ” ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ì™€ ì‹¤ì œ ì‚¬ìš©ì í›„ê¸°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤",
    "additional_queries": ["ê²Œì´ë° í‚¤ë³´ë“œ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ í…ŒìŠ¤íŠ¸ 2024", "ê¸°ê³„ì‹ í‚¤ë³´ë“œ ì¥ê¸° ì‚¬ìš© í›„ê¸° í´ë¦¬ì•™"]
}}
```

ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì‹ ì¤‘íˆ ë¶„ì„í•˜ì—¬ ì§€ì‹ ê²©ì°¨ë¥¼ ì‹ë³„í•˜ê³  ì´ JSON í˜•ì‹ì— ë”°ë¼ ì¶œë ¥ì„ ìƒì„±í•˜ì„¸ìš”:

ì‚¬ìš©ì ìš”ì²­: {user_request}
ê¸°ì¡´ ê²€ìƒ‰ì–´: {queries}
í˜„ì¬ ì œí’ˆ ëª©ë¡:
{products_summary}"""

def get_reflection_prompt(user_request: str, products_or_summary, queries: List) -> List:
    """ê²°ê³¼ í‰ê°€ë¥¼ ìœ„í•œ í”„ë¡¬í”„íŠ¸"""
    # productsê°€ ë¦¬ìŠ¤íŠ¸ì¸ì§€ ë¬¸ìì—´ì¸ì§€ í™•ì¸
    if isinstance(products_or_summary, list):
        # ê¸°ì¡´ ë¡œì§: ì œí’ˆ ë¦¬ìŠ¤íŠ¸ì—ì„œ ìš”ì•½ ìƒì„±
        products_summary = "\n".join([f"- {p.get('name', 'ì•Œ ìˆ˜ ì—†ìŒ')}: {p.get('price_range', 'ê°€ê²© ë¯¸ìƒ')}" for p in products_or_summary[:5]])
    else:
        # ìƒˆë¡œìš´ ë¡œì§: ì´ë¯¸ ìš”ì•½ëœ ë¬¸ìì—´ ì‚¬ìš©
        products_summary = products_or_summary if products_or_summary else "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."
    
    system_prompt = reflection_instructions.format(
        user_request=user_request,
        queries=queries,
        products_summary=products_summary
    )
    
    return [
        SystemMessage(content=system_prompt),
        HumanMessage(content=f"ë‹¤ìŒ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ê³  ì¶”ê°€ ê²€ìƒ‰ì´ í•„ìš”í•œì§€ íŒë‹¨í•´ì£¼ì„¸ìš”.")
    ]

answer_instructions = """ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•´ ì œê³µëœ ì œí’ˆ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°„ê²°í•˜ê³  í•µì‹¬ì ì¸ ì¶”ì²œ ë‹µë³€ì„ ìƒì„±í•´ì£¼ì„¸ìš”.

Instructions:
- ë°”ë¡œ í•µì‹¬ ì¶”ì²œ ì œí’ˆë“¤ì„ 5ê°œê¹Œì§€ ì œì‹œí•˜ì„¸ìš”. ë¶ˆí•„ìš”í•œ ì¸ì‚¬ë§ì´ë‚˜ ê³¼ì • ì„¤ëª…ì€ ìƒëµí•˜ì„¸ìš”.
- ì œí’ˆë³„ë¡œ ëª…í™•í•œ ì¶”ì²œ ì´ìœ ì™€ íŠ¹ì§•ì„ ê°„ê²°í•˜ê²Œ ì„¤ëª…í•˜ì„¸ìš”.
- ì œí’ˆ ì •ë³´ì—ì„œ ì‚¬ìš©í•œ ì¶œì²˜ë¥¼ ë‹µë³€ì— ì˜¬ë°”ë¥´ê²Œ í¬í•¨í•˜ì„¸ìš”. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì„ ì‚¬ìš©í•˜ì„¸ìš” (ì˜ˆ: [ë„¤ì´ë²„ ë¸”ë¡œê·¸](https://example.com)).
- í•œêµ­ì–´ë¡œ ì „ë¬¸ì ì´ê³  ì‹¤ìš©ì ì¸ í†¤ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- "ë§ˆë¬´ë¦¬", "ê¸°íƒ€ ì¶”ì²œ ì œí’ˆ", "ì°¸ê³ ì‚¬í•­" ë“±ì˜ ë¶ˆí•„ìš”í•œ ì„¹ì…˜ì€ ìƒëµí•˜ì„¸ìš”.
- ê³¼ë„í•œ ë‚ ì§œ ì–¸ê¸‰ì€ í”¼í•˜ê³ , í•„ìš”í•œ ê²½ìš°ì—ë§Œ ê°„ë‹¨íˆ ì–¸ê¸‰í•˜ì„¸ìš”.
- í•µì‹¬ ì¶”ì²œ ì œí’ˆë“¤ì—ë§Œ ì§‘ì¤‘í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”.

ë§í¬ ê´€ë ¨ ê·œì¹™:
- ê²€ìƒ‰ ê²°ê³¼ì— ì‹¤ì œ êµ¬ë§¤ ë§í¬ë‚˜ ì œí’ˆ ìƒì„¸ ë§í¬ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ í¬í•¨í•˜ì„¸ìš”.
- ì„ì˜ë¡œ ë§í¬ë¥¼ ìƒì„±í•˜ê±°ë‚˜ "(ì˜ˆì‹œ)" ê°™ì€ ê°€ì§œ í‘œì‹œë¥¼ í•˜ì§€ ë§ˆì„¸ìš”.
- ì‹¤ì œ ë§í¬ê°€ ì—†ìœ¼ë©´ êµ¬ë§¤ ë§í¬ ì„¹ì…˜ì„ ì•„ì˜ˆ ìƒëµí•˜ì„¸ìš”.
- ì¶œì²˜ ë§í¬ë§Œ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ í™•ì¸ëœ ì‹¤ì œ ë§í¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
- ë¬¸ìì—´ì„ ë³´ê³  ì •ìƒì ì¸ ë§í¬ì¸ì§€ íŒë‹¨í•˜ì‹œê³ , ì•„ë‹ ê²½ìš° ë§í¬ë¥¼ ìƒëµí•˜ì„¸ìš”.

Format:
- ì‚¬ìš©ì ìš”ì²­ì— ëŒ€í•œ ì§ì ‘ì ì¸ ì¶”ì²œìœ¼ë¡œ ì‹œì‘
- ê° ì œí’ˆë³„ë¡œ ëª…í™•í•œ êµ¬ì„± (ì œí’ˆëª…, ê°€ê²©ëŒ€, ì£¼ìš” íŠ¹ì§•, ì¶”ì²œ ì´ìœ )
- ê°„ê²°í•˜ê³  ì‹¤ìš©ì ì¸ ì •ë³´ ìœ„ì£¼ë¡œ êµ¬ì„±
- ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ë§í¬ë§Œ í¬í•¨

ì‚¬ìš©ì ìš”ì²­: {user_request}

ì œí’ˆ ì •ë³´:
{products_info}"""

def get_answer_prompt(user_request: str, products_info: str) -> List:
    """ìµœì¢… ë‹µë³€ ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸"""
    system_prompt = answer_instructions.format(
        user_request=user_request,
        products_info=products_info
    )
    
    return [
        SystemMessage(content=system_prompt),
        HumanMessage(content=f"ë‹¤ìŒ ì œí’ˆ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ì¶”ì²œ ë‹µë³€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.")
    ]

report_instructions = """
ë‹¹ì‹ ì€ **ì œí’ˆ ì¶”ì²œ ë¦¬í¬íŠ¸** ì‘ì„± ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì•„ë˜ "ì‚¬ìš©ì ìš”ì²­"ê³¼ "ì œí’ˆ ì •ë³´"ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³ í’ˆì§ˆ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
ë¦¬í¬íŠ¸ëŠ” ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ë§íˆ¬ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
ì‚¬ìš©ìê°€ í¥ë¯¸ë¡œì›Œí•  ë‚´ìš©ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

ì‚¬ìš©ì ìš”ì²­: {user_request}

Instructions:
1. ë¦¬í¬íŠ¸ëŠ” *ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸ ë…¸ì¶œ*ì„ ìµœì†Œí™”í•˜ê³ , **ë¸”ë¡œê·¸ ê¸°ì‚¬**ì²˜ëŸ¼ ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ë‹¨ ìœ„ì£¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.
- ë¦¬í¬íŠ¸ë¥¼ ì²˜ìŒ ìƒì„±í•œê²Œ ì•„ë‹ˆë¼ ì‚¬ìš©ìê°€ ì¶”ê°€ ìš”ì²­ì„ í•œ ê²½ìš°ì—ëŠ” ë§¨ ì•ì¤„ì— ì¶”ê°€ ìš”ì²­ì— ëŒ€í•œ ëŒ€ë‹µì„ í•´ ì£¼ì„¸ìš”.
- ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ìê°€ "ë” ê°’ì´ ì‹¼ ê²ƒì„ ì¶”ì²œí•´ì¤˜" ë¼ê³  í•œ ê²½ìš°, "ì•Œê² ìŠµë‹ˆë‹¤. ë” ì €ë ´í•œ ì œí’ˆì„ ì¶”ì²œí•´ ë“œë¦´ê²Œìš”." ì´ëŸ° ì‹ìœ¼ë¡œ ì¶”ê°€í•´ ì£¼ì„¸ìš”.
2. ê¸°ë³¸ êµ¬ì¡° 
   â€¢ ì œëª©(ë”°ì˜´í‘œ í¬í•¨) â†’ í•œ ì¤„ ì†Œê°œ â†’ êµ¬ë¶„ì„ (`â¸»`) â†’ ì œí’ˆ 5ê°œ ì†Œê°œ â†’ êµ¬ë¶„ì„  â†’ ê¿€íŒ ì„¹ì…˜.  
   â€¢ ì œí’ˆ ì†Œê°œëŠ” "1. ì œí’ˆëª… â€“ íƒœê·¸ë¼ì¸" í•œ ì¤„ í›„, 2â€“3 ì¤„ ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì¥ìœ¼ë¡œ íŠ¹ì§•Â·ì¶”ì²œ ì´ìœ ë¥¼ ì„œìˆ í•©ë‹ˆë‹¤.
   â€¢ ì œí’ˆ ì†Œê°œ í›„ì— ê°€ê²©ì„ ê°„ëµí•˜ê²Œ ì†Œê°œí•©ë‹ˆë‹¤. ì˜ˆ: ê°€ê²©: 155,000ì›
3. ë§í¬ëŠ” `[ì¶œì²˜ ë ˆì´ë¸”] (URL)` í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.  
   ì˜ˆ: `[ë„¤ì´ë²„ ë¸”ë¡œê·¸] (https://example.com)`  
   â–¶ ëŒ€ê´„í˜¸ ì•ˆ **ë ˆì´ë¸”**ë§Œ ì‚¬ìš©ìì—ê²Œ ë³´ì´ê³ , í”„ëŸ°íŠ¸ê°€ ê´„í˜¸ ì† URLì„ í•˜ì´í¼ë§í¬ë¡œ ë§¤í•‘í•©ë‹ˆë‹¤.
4. í•œêµ­ì–´ë¡œ ë”°ëœ»í•˜ê³  ì‹¤ìš©ì ì¸ í†¤ì„ ìœ ì§€í•˜ë˜, ê³¼ë„í•œ ì´ëª¨ì§€ëŠ” í”¼í•©ë‹ˆë‹¤. í•„ìš”í•œ ê²½ìš° 1â€“2ê°œ ì´ëª¨ì§€ë¡œ ê°ì¹ ë§›ë§Œ ì£¼ì„¸ìš”.
5. ì¶œì²˜ URLì´ ì—†ëŠ” ì •ë³´ëŠ” ì‘ì„±í•˜ì§€ ë§ê³ , ì¶œì²˜ëŠ” ë°˜ë“œì‹œ ì‹¤ì œ ë§í¬ë¡œ ë‚¨ê¹ë‹ˆë‹¤.

ì œí’ˆ ì •ë³´:
{products_info}

ì•„ë˜ ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ë˜, ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì§€ ë§ê³  ì‚¬ìš©ì ìš”ì²­ì— ë§ì¶˜ ìƒˆë¡œìš´ ë¦¬í¬íŠ¸ë¥¼ ë§Œë“œì„¸ìš”.:

"ê°€ì„±ë¹„ ë…¸íŠ¸ë¶ TOP 5"

ë°”ìœ ì¼ìƒ ì†ì—ì„œë„ ì§€ê°‘ ì‚¬ì •ì€ ê°€ë³ê²Œ, ë§ˆìŒì€ ë“ ë“ í•˜ê²Œ í•´ ì¤„ ë…¸íŠ¸ë¶ ë‹¤ì„¯ ëŒ€ë¥¼ ê³¨ëìŠµë‹ˆë‹¤. ìˆ«ìë§Œ ë”°ë¼ ë‚´ë ¤ê°€ë©° ìê¸° ìƒí™œì— ê°€ì¥ ì˜ ì–´ìš¸ë¦´ ì¹œêµ¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.

â¸»

1. **ë ˆë…¸ë²„ IdeaPad Slim 5 Gen 10 â€” 14ì‹œê°„ì„ ì±…ì„ì§€ëŠ” ë“ ë“ í•œ ë™í–‰**  
   ì˜¤ë«ë™ì•ˆ ì¶©ì „ ê±±ì • ì—†ì´ ì“¸ ìˆ˜ ìˆëŠ” 1.6 kg ë©”íƒˆ ë…¸íŠ¸ë¶ì´ì—ìš”. 70ë§Œ ì›ëŒ€ì— Ryzen 7ê³¼ sRGB 100 % íŒ¨ë„ê¹Œì§€ ê°–ì¶° ìƒ‰ê°ë„ ë¯¿ìŒì§í•©ë‹ˆë‹¤. ë¨ ì—…ê·¸ë ˆì´ë“œëŠ” ì–´ë µì§€ë§Œ SSDë¥¼ ë‘ ê°œ ê½‚ì„ ìˆ˜ ìˆì–´ ì €ì¥ê³µê°„ ê±±ì •ì€ ëœí–ˆì£ . ê°€ê²©: 155,000ì› [ë„¤ì´ë²„ ë¸”ë¡œê·¸] (https://blog.naver.com/post/1234567890)

2. **ASUS Vivobook 16 (2025) â€” ë„‰ë„‰í•œ í™”ë©´, ê°€ë²¼ìš´ ê°€ê²©**  
   16:10 í™”ë©´ì— ìµœì‹  Snapdragon X ì¹©ì„ ë„£ê³ ë„ 70ë§Œ ì›ëŒ€ì—ì„œ ì‹œì‘í•˜ëŠ” ëŒ€í™”ë©´ ë…¸íŠ¸ë¶ì…ë‹ˆë‹¤. ë°ê¸°ì™€ í‚¤ë³´ë“œëŠ” í‰ë²”í•˜ì§€ë§Œ, ë„“ì€ í™”ë©´ê³¼ ë°°í„°ë¦¬ 14 ì‹œê°„ì€ ìˆ˜ì—…Â·ì—…ë¬´Â·ë„·í”Œë¦­ìŠ¤ê¹Œì§€ ì—¬ìœ ë¡­ì£ . [í‹°ìŠ¤í† ë¦¬] (https://example.tistory.com/1234567890)

3. **Acer Aspire 14 AI â€” ì†Œë°•í•˜ì§€ë§Œ ì•Œì°¬ ê¸°ë³¸ê¸°**  
   14-ì¸ì¹˜ ìš¸íŠ¸ë¼ 5 ëª¨ë¸ì„ 70ë§Œ ì› ì•ˆíŒì— ì‚´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í¬íŠ¸ê°€ ë„‰ë„‰í•˜ê³  ì•Œë£¨ë¯¸ëŠ„ ìƒíŒì´ë¼ ë‚´êµ¬ì„±ë„ ë¬´ë‚œí•´ í•™ìƒÂ·ì‚¬ë¬´ìš© ì²« ë…¸íŠ¸ë¶ìœ¼ë¡œ ì†ìƒ‰ì—†ì–´ìš”. ë‹¤ë§Œ ìƒ‰ì˜ì—­ì´ ì¢ì•„ ì‚¬ì§„Â·ì˜ìƒ ì‘ì—…ì—ëŠ” ì•„ì‰½ìŠµë‹ˆë‹¤. [í‹°ìŠ¤í† ë¦¬] (https://example.tistory.com/1234567890)

4. **Dell 14 Plus (2025) â€” í•„ìš”í•œ ê²ƒë§Œ ë‹´ì€ ì‹¤ì†í˜•**  
   90ë§Œ ì›ëŒ€ì— Intel Lunar Lakeë‚˜ Ryzen AI 300ì„ ê³ ë¥¼ ìˆ˜ ìˆê³ , ì•Œë£¨ë¯¸ëŠ„ ë°”ë””ê°€ "ê°€ì„±ë¹„ = íˆ¬ë°•í•¨" í¸ê²¬ì„ ê¹¨ ì¤ë‹ˆë‹¤. ì˜ìƒ í¸ì§‘Â·ê²Œì´ë°ì—” ë¶€ì¡±í•˜ì§€ë§Œ ë¬¸ì„œÂ·íšŒì˜ ì¤‘ì‹¬ ì‚¬ìš©ìë¼ë©´ ë§Œì¡±ìŠ¤ëŸ¬ì›Œìš”. ê°€ê²©: 105,000ì› [í‹°ìŠ¤í† ë¦¬] (https://example.tistory.com/1234567890)

5. **HP Pavilion Aero 13 (2024) â€” 1 kg ì´ˆê²½ëŸ‰, ì¶œê·¼ê¸¸ì˜ íë§**  
   1 kg ì•ˆíŒì— QHD+ IPS íŒ¨ë„, Ryzen 8040Uë¥¼ ë„£ì€ íœ´ëŒ€ìš© ë…¸íŠ¸ë¶ì…ë‹ˆë‹¤. ë°°í„°ë¦¬ë„ í•˜ë£¨ ì¢…ì¼ ë²„í…¨ ì¶©ì „ê¸° ì—†ì´ë„ ë‹¹ë‹¹í•˜ì£ . ìœ ê´‘ ë§ˆê°ì€ ì•½ê°„ í ì§‘ì— ì•½í•˜ì§€ë§Œ, ë°ì€ í™”ë©´ê³¼ ì‹œì›í•œ í‚¤ë³´ë“œë¡œ ê¸ˆì„¸ ë§ˆìŒì„ ëŒë ¤ì¤ë‹ˆë‹¤. ê°€ê²©: 455,000ì› [í‹°ìŠ¤í† ë¦¬] (https://example.tistory.com/1234567890)

â¸»

ğŸ’¡ **ì•Œëœ°í•˜ê²Œ ê³ ë¥´ëŠ” íŒ**  
â€¢ í•˜ë£¨ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¨¼ì € ê·¸ë ¤ë³´ì„¸ìš”.  
â€¢ ìŠ¤í™í‘œ ë°°í„°ë¦¬ ì‹œê°„ì—ì„œ 20 %ë¥¼ ë¹¼ë©´ í˜„ì‹¤ ì‚¬ìš© ì‹œê°„ì„ ê°€ëŠ í•  ìˆ˜ ìˆì–´ìš”.  
â€¢ ë””ìì¸ê³¼ ë¬´ê²Œê°€ ë§ˆìŒì— ë“¤ì–´ì•¼ ì†ì´ ìì£¼ ê°‘ë‹ˆë‹¤.  
â€¢ ì™„ë²½í•˜ì§„ ì•Šì•„ë„ "ê°€ê²© + í–‰ë³µì§€ìˆ˜"ê°€ ì¶©ë¶„í•˜ë©´ OK!

ë…¸íŠ¸ë¶ì´ ë‹¨ìˆœí•œ ê¸°ê¸°ë¥¼ ë„˜ì–´, í•˜ë£¨ ë ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ì²˜ëŸ¼ ë‹¹ì‹ ì„ ìœ„ë¡œí•´ ì£¼ê¸¸ ë°”ë¼ëŠ” ë§ˆìŒìœ¼ë¡œ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤. ìƒˆ ì¹œêµ¬ ê³ ë¥´ê¸°ì— í–‰ë³µì´ ê°€ë“í•˜ê¸¸!
"""

# -------------------------------------------------
# Helper Function: get_report_prompt
# -------------------------------------------------

def get_report_prompt(user_request: str, products_info: str) -> List:
    """ì œí’ˆ ì¶”ì²œ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•œ ì‹œìŠ¤í…œ + íœ´ë¨¼ ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

    Parameters
    ----------
    user_request : str
        ì‚¬ìš©ìì˜ ì›ë³¸ ìš”ì²­(ì˜ˆ: "10ë§Œ ì› ì´í•˜ ê°€ì„±ë¹„ ì´ì–´í° ì¶”ì²œ")
    products_info : str
        ì›¹ ê²€ìƒ‰ ìš”ì•½ ë“± ë¦¬í¬íŠ¸ì— í¬í•¨í•  ìƒì„¸ ì œí’ˆ ì •ë³´(ë§ˆí¬ë‹¤ìš´ ê°€ëŠ¥)

    Returns
    -------
    List[BaseMessage]
        LangChain í˜¸í™˜ ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸ (SystemMessage, HumanMessage)
    """

    system_msg = SystemMessage(
        content=report_instructions.format(
            user_request=user_request,
            products_info=products_info,
        )
    )

    human_msg = HumanMessage(
        content="ìœ„ ì§€ì¹¨ì— ë”°ë¼ ì œí’ˆ ì¶”ì²œ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”."
    )

    return [system_msg, human_msg]